<!DOCTYPE HTML>
<html>

<head>
    <title>this is a test</title>
    <meta charset="UTF-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="scripts/snippets.js"></script>
    <script src="scripts/ImageBit.js"></script> 
    <script src="scripts/MSet.js"></script> 

    <link rel="stylesheet" type="text/css" href="styles/tasks.css">

    <script>
        var canvas1;
        var canvas2;
        var mouseWindowHeight, mouseWindowWidth;
        var oldX, oldY;
        var op;
        var ctx1, ctx2;


        function init() {

            canvas1 = document.getElementById("canvas1");
            ctx1 = canvas1.getContext("2d");
            canvas2 = document.getElementById("canvas2");
            ctx2 = canvas2.getContext("2d");
          
            canvas1.width = $("#canvasContainer").width();
            canvas1.height = $("#canvasContainer").height();
            canvas2.width = $("#canvasContainer").width();
            canvas2.height = $("#canvasContainer").height();

            mouseWindowWidth = canvas1.width / 5 + 1;
            mouseWindowHeight = canvas1.height / 5 + 1;

            document.getElementById("out1").value = -2.5;
            document.getElementById("out2").value = 1.2;
            document.getElementById("out3").value = 0.55;


            /*******************************************************
            /* Clear the sprite when the mouse leaves the canvas
            /*******************************************************/

            canvas2.onmouseleave = function (e) {
                ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
             }
            
            /*******************************************************
            /* Redraws the sprite when the mouse moves
            /*******************************************************/

            canvas2.onmousemove = function (e) {
                
                relativeCoords = canvas2.relativeMouseCoords(e);
                ctx2.clearRect(oldX - mouseWindowWidth / 2 - 3, oldY - mouseWindowHeight / 2 - 3, mouseWindowWidth + 6, mouseWindowHeight + 6);

                ctx2.fillStyle = "rgba(150, 240, 100, 0.2)";
                ctx2.fillRect(relativeCoords.x - mouseWindowWidth / 2, relativeCoords.y - mouseWindowHeight / 2, mouseWindowWidth, mouseWindowHeight);

                oldX = relativeCoords.x; oldY = relativeCoords.y;

            };

            /*******************************************************
            /* Resizes when the mouse wheel scrolls
            /*******************************************************/

            canvas2.onmousewheel = function (e) {

                relativeCoords = canvas2.relativeMouseCoords(e);

                var delta = Math.max(-1, Math.min(1, e.wheelDelta));
                mouseWindowHeight = (1 + 0.2 * delta) * mouseWindowHeight;
                mouseWindowWidth = (1 + 0.2 * delta) * mouseWindowWidth;

                ctx2.clearRect(0,0,canvas2.width, canvas2.height);
                ctx2.fillStyle = "rgba(150, 240, 100, 0.2)";
                ctx2.fillRect(relativeCoords.x - mouseWindowWidth / 2, relativeCoords.y - mouseWindowHeight / 2, mouseWindowWidth, mouseWindowHeight);

                oldX = relativeCoords.x; oldY = relativeCoords.y;

                return false; //this prevents the default scrolling
            }
            

            /*******************************************************
            /* Clear the sprite when the mouse leaves the canvas
            /*******************************************************/

            canvas2.onmouseup = function (e) {

                relativeCoords = canvas2.relativeMouseCoords(e);
            
                var currX1 = parseFloat(document.getElementById("out1").value);
                var currY1 = parseFloat(document.getElementById("out2").value);
                var currX2 = parseFloat(document.getElementById("out3").value);
                var xSpan = currX2 - currX1;
                var ySpan = xSpan * canvas2.height/canvas2.width;

                var x1 = currX1+(relativeCoords.x - mouseWindowWidth / 2)/canvas2.width*xSpan;
                var y1 = currY1-(relativeCoords.y - mouseWindowHeight / 2)/canvas2.height*ySpan;
                var x2 = currX1+(relativeCoords.x + mouseWindowWidth / 2)/canvas2.width*xSpan;

                document.getElementById("out1").value = x1;
                document.getElementById("out2").value = y1;
                document.getElementById("out3").value = x2;


                paintSet();

            }
        }   // End of the init function. 


        /*******************************************************
        /* Triggers the computation and drawing of the Set
        /*******************************************************/

        function paintSet() {

            var imgDt = ctx1.getImageData(0, 0, canvas1.width, canvas1.height);
            var x1 = parseFloat(document.getElementById("out1").value);
            var y1 = parseFloat(document.getElementById("out2").value);
            var x2 = parseFloat(document.getElementById("out3").value);

            var imb = new ImageBit(imgDt, canvas1.width, canvas1.height, x1,y1,x2);
            imb.fillColor(0, 0, 0, 0);

            var maxiter = Math.abs( 350 * Math.log(x2 - x1));
            document.getElementById("out4").value = maxiter;
            var threshold = 10+Math.abs(Math.log(x2 - x1));
            document.getElementById("out4").value = threshold;

            var m = new MSet(maxiter, threshold);
            m.paint(imb);
       
            ctx1.putImageData(imb.imgData, 0, 0);
        }



        
    </script>

</head>


<body onload="init();">
    <div style="width: 760px">
        <div id="canvasContainer" style="position:relative; height:500px; width:800px" >
            <canvas id="canvas1"></canvas>
            <canvas id="canvas2"></canvas>
        </div>

        <div class="item_line">
            <button onclick="paintSet()">Fill</button>
            <label id="outl1" style="margin-left: 50px">In</label>
            <input id="out1"; >
            <label id="outl2">Circle</label>
            <input id="out2"; >
            <label id="outl3">just out</label>
            <input id="out3"; >
            <label id="outl4">Y2</label>
            <input id="out4"; >
        </div>
    </div>
</body>
</html>
